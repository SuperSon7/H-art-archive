services:
  web:
    # ğŸ’¡ CIì—ì„œ ë¹Œë“œë  ì´ë¯¸ì§€ì˜ ìµœì¢… ì´ë¦„ê³¼ íƒœê·¸
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-web:${IMAGE_TAG:-latest}
    build:
      # ğŸ’¡ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìºì‹œ ì„¤ì •
      cache_from:
        - type=registry,ref=ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-web-cache:latest
      cache_to:
        - type=registry,ref=ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-web-cache:latest,mode=max
    # ğŸ’¡ CI í™˜ê²½ì—ì„œ ì‹¤í–‰í•  í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
    command: pytest -q ${PYTEST_MARKEXPR:+-m "$PYTEST_MARKEXPR"}

  celery:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-celery:${IMAGE_TAG:-latest}
    build:
      cache_from:
        - type=registry,ref=ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-celery-cache:latest
      cache_to:
        - type=registry,ref=ghcr.io/${GITHUB_REPOSITORY_OWNER_LOWER}/${COMPOSE_PROJECT_NAME}-celery-cache:latest,mode=max
    # CIì—ì„œëŠ” Celeryë¥¼ ì‹¤í–‰í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ commandë¥¼ ë¹„ì›Œë‘¡ë‹ˆë‹¤.
    command: tail -f /dev/null
